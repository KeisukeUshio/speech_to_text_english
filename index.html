<!DOCTYPE html>
<html>
 
<head>
    <meta charset="UTF-8">
    <meta name="robots" content "noindex">
    <title>Speech to Text</title>
    <style type="text/css">
        .main {
            margin: 1.5rem;
            width: 960px;
        }
        .text_area {
          display: block;
          width: 800px;
          height: 160px;
          margin-top: 40px;
          margin-left: auto;
          margin-right: auto;
          font-size: 30px;
          font-family: 'Noto Sans JP', 'Hiragino Kaku Gothic ProN', sans-serif;
          color: #fff;
          background-color: black;
        }
        .status_area {
          display: block;
          width: 800px;
          height: 80px;
          margin-top: 40px;
          margin-left: auto;
          margin-right: auto;
          border-color: black;
        }
        input {
          display: block;
          width: 160px;
          height: 80px;
          margin-top: 40px;
          margin-left: auto;
          margin-right: auto;
          background-color: white;
          color: black;
          font-size:20px;
          font-family: 'Noto Sans JP', 'Hiragino Kaku Gothic ProN', sans-serif;;
          border-radius: 10px;
        }
        </style>

    <script>
        var flag_speech = 0;
 
        function vr_function() {
            window.SpeechRecognition = window.SpeechRecognition || webkitSpeechRecognition;
            var recognition = new webkitSpeechRecognition();
            recognition.lang = 'ja';
            recognition.interimResults = true;
            recognition.continuous = true;
 
            recognition.onsoundstart = function() {
                document.getElementById('status').innerHTML = "認識中";
            };
            recognition.onnomatch = function() {
                document.getElementById('status').innerHTML = "retry";
            };
            recognition.onerror = function() {
                document.getElementById('status').innerHTML = "error";
                if(flag_speech == 0)
                  vr_function();
            };
            recognition.onsoundend = function() {
                document.getElementById('status').innerHTML = "停止中";
                  vr_function();
            };
 
            recognition.onresult = function(event) {
                var results = event.results;
                for (var i = event.resultIndex; i < results.length; i++) {
                    if (results[i].isFinal)
                    {
                        document.getElementById('result_text').innerHTML = results[i][0].transcript;
                        vr_function();
                    }
                    else
                    {
                        document.getElementById('result_text').innerHTML = "[認識途中] " + results[i][0].transcript;
                        flag_speech = 1;
                    }
                }
            }
            flag_speech = 0;
            document.getElementById('status').innerHTML = "start";
            recognition.start();
        }
        function googleTranslateElementInit() {
            new google.translate.TranslateElement({
                    pageLanguage: 'ja',
                    layout: google.translate.TranslateElement.InlineLayout.SIMPLE
                }, 'google_translate_element');
        }
    </script>
    <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
</head>
 
<body>
    <div class="main">
        <div id="result_text" class="text_area" cols="40" rows="3">
        </div>
        <div id="status" class="status_area" cols="40" rows="1">
        </div>
        <input type="button" onClick="vr_function();" value="認識開始">
        <div id="google_translate_element">
        </div>    
    </div>
</body>
 
</html>